# Created 2021-03-02 Tue 09:18
#+title: Discussion
#+author: Jonghyun Yun
#+date: today

# https://orgmode.org/manual/Export-Settings.html#Export-Settings
#+options: H:4 num:nil toc:nil pri:t ::t |:t f:t <:t -:t \n:nil ':t ^:nil
#+options: d:nil todo:t tags:nil tex:t

#+startup: overview inlineimages logdone indent noalign
# noindent

#+latex_class: article
#+latex_class_options: [letterpaper,11pt]

#+latex_compiler: pdflatex
# comment out for reveal.js
# #+setupfile: ~/setup/my-theme-readtheorg.setup
#+setupfile: ~/org/latex_header.setup
#+setupfile: ~/org/orgmode_header.setup

#+property: header-args :tangle
#+property: header-args :eval never-export
#+property: header-args:R :session *R-Org* :exports both :results output :noweb yes :eval nil

* Updates :ATTACH:
:PROPERTIES:
:ID:       4dfb1c3d-cc63-4571-9232-fc3f6b4bb95d
:NOTER_DOCUMENT: /Users/yunj/org/.attach/4d/fb1c3d-cc63-4571-9232-fc3f6b4bb95d/summary_simulation.pdf
:NOTER_PAGE: 2
:END:
- Code debugging finished for MCMC sampler ($\beta, \theta$)
- $\beta_{ic}$ is non-identifiable, dropped.
- New posterior analysis is ready to look.
- piecewise approximation segment number: back to 5 (was 2).
  - at a small # of segments, the latent space doesn't improve the fit to chessB data (log-loss).
    See Figure [[fig:ff12]]
** my note
:PROPERTIES:
:NOTER_PAGE: (1 . 0.6106060606060606)
:END:
** base
:PROPERTIES:
:NOTER_PAGE: (1 . 0.6106060606060606)
:END:




* sample code
#+name: tab:2
#+caption: tab:2 caption
| 1 | 2 |
| 3 | 4 |

* Log-loss
:PROPERTIES:
:Effort:   0:05
:END:
:LOGBOOK:
CLOCK: [2021-04-16 Fri 22:09]--[2021-04-16 Fri 22:42] =>  0:33
:END:
Given the survival time $t$ and MCMC samples, the conditional probability of "correct" response is estimated as
\[
\hat p_{ik}^{(l)}(t) = \frac{h_{i1}^{(l)}(t)}{h_{i1}^{(l)}(t) + h_{i0}^{(l)}(t)},
\]
where $(l)$ denote the index of MCMC sample used to calculate the quantity.
We use $Y_{ik} = 1$ to denote a correct response, and $Y_{ik} = 0$ an incorrect response. Then, $p_{ik}^{(l)}(t)$ can be served as the prediction probability of $Y_{ik}$, which allows using classification performance metrics. For easiness of evaluation, we use the log-loss for item:

\begin{equation}
\label{eq:3}
-\frac{1}{N}
\sum_{k} \left\{ y_{ik} \log \hat p_{ik}^{(l)}(t) + (1-y_{ik}) \log (1 - \hat p_{ik}^{(l)})\right\}.
\end{equation}

* Models :job:
=double pp= model:
the smaller distance, the faster process


#+name: tab:1
#+caption: table caption
|   2 | 3 | 4 |
| 4 5 | 4 | 4 |

goto Figure [[fig:ff99]]
\begin{align}
\label{eq:my2}
h_{i1}(t) &= \lambda_{i1}(t) \exp(\theta_{k1} - \gamma_{1} ||z_{k1} - w_{i1}||) \\
h_{i0}(t) &= \lambda_{i0}(t) \exp(\theta_{k0} - \gamma_{0} ||z_{k0} - w_{i0}||) \\
\end{align}

=np= model: the smaller distance, the more distinct process (in terms of speed).
\begin{align*}
h_{i1}(t) &= \lambda_{i1}(t) \exp(\theta_{k1} + \gamma ||z_{k} - w_{i}||) \\
h_{i0}(t) &= \lambda_{i0}(t) \exp(\theta_{k0} - \gamma ||z_{k} - w_{i}||) \\
\end{align*}

referencing Equation2
\ref{eq:3}
* $\gamma$ is non-identifiable, but it's ok to keep :auto:
=np= model with $\gamma = 1$.
\begin{align*}
h_{i1}(t) &= \lambda_{i1}(t) \exp(\theta_{k1} + ||z_{k} - w_{i}||) \\
h_{i0}(t) &= \lambda_{i0}(t) \exp(\theta_{k0} - ||z_{k} - w_{i}||) \\
\end{align*}
 - priors on the latent space
   \begin{align*}
   \pi\left(\mathbf{z}_{j}\right) & \sim \mathrm{MVN}_{d}\left(0, I_{d}\right) \\
   \pi\left(\mathbf{w}_{i}\right) & \sim \mathrm{MVN}_{d}\left(0, I_{d}\right) \\
   \end{align*}
 - results (latent space structure) heavily depend on the prior variance ($\sigma_{zw}$) of $z_{k}$ and $w_{i}$.
 - we should let the data determine $\sigma_{zw}$.

* TODO fit the model
- State "KILL"       from "TODO"       [2021-03-29 Mon 09:29] \\
  cannot do the model selection based on a non-identifiable parameter.
\begin{align*}
h_{i1}(t) &= \lambda_{i1}(t) \exp(\theta_{k1} + \gamma_{} ||z_{k} - w_{i}||) \\
h_{i0}(t) &= \lambda_{i0}(t) \exp(\theta_{k0} - \gamma_{} ||z_{k} - w_{i}||) \\
\end{align*}
\[
\gamma_{} \sim N(0,1)
\]

* diffused priors?
\begin{align*}
\pi\left(\lambda_{ic,j}\right) & \sim \operatorname{Gamma}\left(\text{mean} = \tilde \lambda_{ic,j}, \text{var} = C \cdot \tilde \lambda_{ic,j})\right) \\
\pi\left(\theta_{k} | \sigma^{2}\right) & \sim \mathrm{N}\left(0, \sigma^{2}\right) \\ \pi\left(\sigma^{2}\right) & \sim \operatorname{lnv}-\operatorname{Gamma}\left(a_{\sigma}, b_{\sigma}\right) \\
\pi\left(\mathbf{z}_{j}\right) & \sim \mathrm{MVN}_{d}\left(0, I_{d}\right) \\
\pi\left(\mathbf{w}_{i}\right) & \sim \mathrm{MVN}_{d}\left(0, I_{d}\right) \\
\pi(
\log \gamma) & \sim \mathrm{N}\left(\mu_{\gamma}, \tau_{\gamma}^{2}\right)
\end{align*}
\[C = 2, a_{\sigma}=0.0001, b_{\sigma}=0.0001, \mu_{\gamma}=0, \text { and } \tau_{\gamma}^{}=2\]
* New results with unknown $\gamma > 0$.
Figure ff12 [[fig:ff12]]
figure ff99 [[fig:ff99]]
baseline model:
\begin{align}
\label{eq:1}
h_{i1}(t) &= \lambda_{i1}(t) \exp(\theta_{k1})\\
h_{i0}(t) &= \lambda_{i0}(t) \exp(\theta_{k0})\\
\end{align}

referencing Equation2 \ref{eq:my2}
table Table [[tab:ttt99]]

#+name: fig:ff12
#+caption: fig ff12 caption
[[file:/Users/yunj/Dropbox/research/lsjm-art/my-diagram.png]]

go to Table 2 [[tab:2]]
go to Equation \ref{eq:1}.
go to Table [[tab:1]]

cite:cox_renewal_1962

cite:olding_biology_1983

cite:sharp2009cell

cite:yun_augmented_2017

cite:yun_r_parclip

cite:yun_r_parclip


#+name: fig:ff99
#+caption: fig ff99 caption
[[file:/Users/yunj/Dropbox/research/lsjm-art/my-diagram.png]]

#+name: tab:ttt99
#+caption: ttt99 caption
|----+---|
|  1 | 3 |
|----+---|
|  3 | 4 |
| 24 | 4 |


#+bibliography:~/Zotero/myref.bib
#+PANDOC-CSL: /Users/yunj/Zotero/styles/cell.csl
#+PANDOC_OPTIONS: number-sections:t
#+PANDOC_OPTIONS: standalone:t
#+PANDOC_OPTIONS: csl:/Users/yunj/Zotero/styles/ieee.csl
#+PANDOC_OPTIONS: biblatex:t natbib:t
#+PANDOC_OPTIONS: citeproc:t

# bibliographystyle:unsrt
# bibliography:~/Zotero/myref.bib

#+latex:\printbibliography
#+CSL_STYLE: /Users/yunj/Zotero/styles/cell.csl

#+begin_src emacs-lisp :exports none
(add-to-list 'org-pandoc-valid-options 'citeproc)
(setq org-export-with-tags nil)
#+end_src

#+RESULTS:

#+begin_src emacs-lisp :exports none
(org-latex-export-to-latex)
(shell-command "pandoc -s -f latex -t markdown discussion.tex -o discussion.md")
#+end_src

#+RESULTS:
: 0


#+begin_src emacs-lisp :exports none
(shell-command "pandoc -f markdown -t docx -F pandoc-crossref -C --citeproc \
--biblatex --natbib --mathjax \
--csl=/Users/yunj/Zotero/styles/cell.csl --bibliography=/Users/yunj/Zotero/myref.bib \
discussion.md -o md.docx")
(shell-command "open md.docx")
#+end_src

#+RESULTS:
: 0

* graphs :noexport:
#+name: emacs-platform
#+begin_src dot :cmd circo :file misc/emacs-platform.svg :exports none
digraph {
    graph [bgcolor="transparent"];
    node  [shape="underline" penwidth="2" style="rounded,filled" fillcolor="#efefef" color="#c9c9c9" fontcolor="#000000" fontname="overpass"];
    edge  [arrowhead=none color="#aaaaaa" penwidth="1.2"]
    // nodes
    "Task Managment" [color="#2ec27e"]
    "Email" [color="#1c71d8"]
    "Office suite" [color="#813d9c"]
    "Code editor" [color="#f5c211"]
    "Git client" [color="#e66100"]
    // "News feed" [color="#c01c28"]
    // "Personal Knowledge Base" [color="#986a44"]

    "Task Managment" -> "Email"
    "Task Managment" -> "Office suite"
    "Task Managment" -> "Code editor"
    "Task Managment" -> "Git client"
    // "Task Managment" -> "News feed"
    // "Task Managment" -> "Personal Knowledge Base"

    "Email" -> "Office suite"
    "Email" -> "Code editor"
    "Email" -> "Git client"
    // "Email" -> "Personal Knowledge Base"

    "Office suite" -> "Code editor"
    "Office suite" -> "Git client"
    // "Office suite" -> "News feed"
    // "Office suite" -> "Personal Knowledge Base"

    "Code editor" -> "Git client"

    // "News feed" -> "Personal Knowledge Base"
}
#+end_src

#+caption: Some sample workflow integrations that can be used within Emacs
#+attr_html: :class invertible :alt Graph of possible Emacs task integrations :style max-width:min(24em,100%)
#+attr_latex: :width 0.55\linewidth
[[file:misc/emacs-platform.svg]]


Graphviz is a nice method of visualising simple graphs, based on plaintext
=.dot= / =.gv= files.
#+begin_src emacs-lisp
(package! graphviz-dot-mode :pin "3642a0a5f41a80c8ecef7c6143d514200b80e194")
#+end_src

#+begin_src emacs-lisp
(use-package! graphviz-dot-mode
  :commands graphviz-dot-mode
  :mode ("\\.dot\\'" "\\.gz\\'")
  :init
  (after! org
    (setcdr (assoc "dot" org-src-lang-modes)
            'graphviz-dot)))

(use-package! company-graphviz-dot
  :after graphviz-dot-mode)
#+end_src


#+attr_latex: :align *{8}{p{0.105\linewidth}} :font \small
#+plot: transpose:yes type:radar min:0 max:4 file:"misc/document-format-comparison.svg"
| Format            | Fine-grained control | Initial ease of use | Syntax simplicity | Editor Support | Integrations | Ease-of-referencing | Versatility |
|-------------------+----------------------+---------------------+-------------------+----------------+--------------+---------------------+-------------|
| Word              |                    2 |                   4 |                 4 |              2 |            3 |                   2 |           2 |
| LaTeX             |                    4 |                   1 |                 1 |              3 |            2 |                   4 |           3 |
| Org Mode          |                    4 |                   2 |               3.5 |              1 |            4 |                   4 |           4 |
| Markdown          |                    1 |                   3 |                 3 |              4 |            3 |                   3 |           1 |
| Markdown + Pandoc |                  2.5 |                 2.5 |               2.5 |              3 |            3 |                   3 |           2 |

#+attr_html: :class invertible :alt Radar chart comparing my opinions of document formats.
#+attr_latex: :options inkscapelatex=false
[[file:misc/document-format-comparison.svg]]
